# Custom nginx configuration for Elastic Beanstalk
# This file is automatically loaded by EB

# -------------------------------------------------
# Client body size limit (200MB uploads)
# -------------------------------------------------
client_max_body_size 200M;

# -------------------------------------------------
# Increase proxy timeouts for large file uploads
# -------------------------------------------------
proxy_connect_timeout 600;
proxy_send_timeout    600;
proxy_read_timeout    600;
send_timeout          600;

# -------------------------------------------------
# Disable buffering for large requests (important for Node.js streaming)
# -------------------------------------------------
proxy_buffering off;
proxy_request_buffering off;

# -------------------------------------------------
# Headers passed to Node.js
# -------------------------------------------------
proxy_set_header Host              $host;
proxy_set_header X-Real-IP         $remote_addr;
proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;
proxy_set_header Connection "";

# -------------------------------------------------
# Force HTTP/1.1 (needed for chunked requests & WebSockets)
# -------------------------------------------------
proxy_http_version 1.1;
